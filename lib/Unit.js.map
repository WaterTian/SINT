{"version":3,"sources":["../src/Unit.js"],"names":["getUrlStr","degToRad","getImageXYData","getImageRGBAData","getTxtImage","canvasToImage","readFile","readJson","loadJson","postJson","name","reg","RegExp","r","window","location","search","substr","match","unescape","degrees","Math","PI","img","w","h","templateCanvas","document","createElement","body","appendChild","width","height","imgContext","getContext","drawImage","imgData","getImageData","removeChild","xyrgbData","_hw","_hh","i","j","_num","_rgb","data","push","txt","size","c","ctx","font","fillStyle","textAlign","fillText","toDataURL","src","canvas","gl","preserveDrawingBuffer","file","console","log","type","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","e","test","result","onerror","Error","readAsText","JSON","parse","url","request","XMLHttpRequest","open","send","status","responseText","sendData","$","ajax","success","error","jqXHR","textStatus","errorThrown"],"mappings":"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","file":"Unit.js","sourcesContent":["export function getUrlStr(name) {\n\tlet reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n\tlet r = window.location.search.substr(1).match(reg);\n\tif (r != null) return unescape(r[2]);\n\treturn null;\n}\n\nexport function degToRad(degrees) {\n\treturn degrees * Math.PI / 180;\n}\n\n\nexport function getImageXYData(img, w, h) {\n\n\tlet templateCanvas = document.createElement('canvas');\n\tdocument.body.appendChild(templateCanvas);\n\ttemplateCanvas.width = w;\n\ttemplateCanvas.height = h;\n\n\tlet imgContext = templateCanvas.getContext(\"2d\");\n\timgContext.drawImage(img, 0, 0, w, h);\n\n\tlet imgData = imgContext.getImageData(0, 0, w, h);\n\tdocument.body.removeChild(templateCanvas);\n\n\n\tlet xyrgbData = [];\n\tlet _hw = w * 0.5;\n\tlet _hh = h * 0.5;\n\tfor (let i = 0; i < h; i += 2) {\n\t\tfor (let j = 0; j < w; j += 2) {\n\t\t\tlet _num = i * w + j;\n\t\t\tlet _rgb = [imgData.data[_num * 4], imgData.data[_num * 4 + 1], imgData.data[_num * 4 + 2], imgData.data[_num * 4 + 3]];\n\t\t\tif (imgData.data[_num * 4 + 3] > 0) xyrgbData.push([j - _hw, -i + _hh, _rgb]);\n\t\t}\n\t}\n\treturn xyrgbData;\n}\n\nexport function getImageRGBAData(img, w, h) {\n\n\tlet templateCanvas = document.createElement('canvas');\n\tdocument.body.appendChild(templateCanvas);\n\ttemplateCanvas.width = w;\n\ttemplateCanvas.height = h;\n\n\tlet imgContext = templateCanvas.getContext(\"2d\");\n\timgContext.drawImage(img, 0, 0, w, h);\n\n\tlet imgData = imgContext.getImageData(0, 0, w, h);\n\tdocument.body.removeChild(templateCanvas);\n\n\treturn imgData;\n}\n\nexport function getTxtImage(txt, size = 50) {\n\tlet c = document.createElement('canvas');\n\tdocument.body.appendChild(c);\n\tc.width = 512;\n\tc.height = 128;\n\n\tlet ctx = c.getContext(\"2d\");\n\n\tctx.font = size + \"px Verdana\";\n\tctx.fillStyle = '#ffffff';\n\tctx.textAlign = \"center\";\n\tctx.fillText(txt, 256, 64);\n\n\tlet imgData = c.toDataURL(\"image/png\");\n\tdocument.body.removeChild(c);\n\n\tlet img = document.createElement('img');\n\timg.src = imgData;\n\treturn img;\n}\n\n\nexport function canvasToImage(canvas) {\n\tlet gl = canvas.getContext(\"experimental-webgl\", {\n\t\tpreserveDrawingBuffer: true\n\t});\n\n\tlet imgData = canvas.toDataURL(\"image/png\");\n\n\tlet img = document.createElement('img');\n\timg.src = imgData;\n\treturn img;\n}\n\n\nexport function readFile(file) {\n\tconsole.log(file.type);\n\n\treturn new Promise(function(resolve, reject) {\n\t\tconst reader = new FileReader();\n\t\treader.readAsDataURL(file);\n\n\t\treader.onload = function(e) {\n\t\t\tif (/image\\/\\w+/.test(file.type)) console.log('type: /image');\n\t\t\telse resolve(this.result);\n\t\t}\n\n\t\treader.onerror = function() {\n\t\t\treject(new Error('Could not load file' + file));\n\t\t};\n\t});\n}\n\nexport function readJson(file) {\n\tconsole.log(file.type);\n\n\treturn new Promise(function(resolve, reject) {\n\t\tconst reader = new FileReader();\n\t\treader.readAsText(file);\n\n\t\treader.onload = function(e) {\n\t\t\tresolve(JSON.parse(this.result));\n\t\t}\n\n\t\treader.onerror = function() {\n\t\t\treject(new Error('Could not load file' + file));\n\t\t};\n\t});\n}\n\n\nexport function loadJson(url) {\n\treturn new Promise(function(resolve, reject) {\n\t\tconst request = new XMLHttpRequest();\n\t\trequest.open(\"GET\", url);\n\t\trequest.send(null);\n\t\trequest.onload = function(e) {\n\t\t\tif (request.status == 200) {\n\t\t\t\tresolve(JSON.parse(this.responseText));\n\t\t\t} else {\n\t\t\t\treject(new Error('Could not loadJson'));\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport function postJson(url, sendData) {\n\treturn new Promise(function(resolve, reject) {\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl: url,\n\t\t\tdata: sendData,\n\t\t\tsuccess: function(data) {\n\t\t\t\tresolve(JSON.parse(data));\n\t\t\t},\n\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\t\t\t\treject(textStatus);\n\t\t\t}\n\t\t});\n\t});\n}"]}